    services:
      db:
        image: postgres:14
        environment:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: 6713
          POSTGRES_DB: archangel
        volumes:
          - postgres_data:/var/lib/postgresql/data
        networks:
          - backend

      archangel:
        build: .
        command: gunicorn Archangel.wsgi:application --bind 0.0.0.0:5000
        volumes:
          - .:/app
        expose:
          - "5000"  # Используем expose, потому что проксирование будет через NGINX
        depends_on:
          - db
        networks:
          - backend

      nginx:
        build:
          context: ./nginx
          dockerfile: Dockerfile
        container_name: nginx
        ports:
          - "80:80"
        volumes:
          - ./staticfiles:/usr/share/nginx/html/static
        depends_on:
          - archangel
        networks:
          - backend

      fetcher:
        build:
          context: ./services/scraper_service
          dockerfile: Dockerfile
        container_name: fetcher
        ports:
          - "8044:8044"
        env_file:
          - .env


    volumes:
      postgres_data:
      static:
      media:

    networks:
      backend:
